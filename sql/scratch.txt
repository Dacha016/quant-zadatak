
//DELETE TABLE
DROP TABLE doctrine_migration_versions;

//add AUTO_INCREMENT
ALTER TABLE user
    CHANGE id id INT AUTO_INCREMENT;

// user username
ALTER TABLE user
    CHANGE username username VARCHAR(50) NOT NULL UNIQUE;

//user email
ALTER TABLE user
    CHANGE email email VARCHAR(50) NOT NULL UNIQUE

//user password
ALTER TABLE user
    CHANGE password password VARCHAR(255) NOT NULL;

//user apy_key
ALTER TABLE user
    RENAME COLUMN apy_key TO api_key;

//user role
ALTER TABLE user
    CHANGE role role VARCHAR(20) DEFAULT 'user';

// add nsfw
ALTER TABLE user
ADD nsfw int DEFAULT 0

// add active
ALTER TABLE user
ADD active int DEFAULT 0
//change to pictures
UPDATE image SET file_name = concat('https://picsum.photos/200/300?random=', id);

ALTER TABLE user
    CHANGE id id INT AUTO_INCREMENT;

// create table moderators_logging
create table moderator_logging
(
    id int primary key not null,
    moderators_username varchar(50) unique not null,
    users_username varchar(50) unique not null,
    gallery_id int null,
    image_path varchar(150) null,
    hidden int null,
    nsfw int null
)


//drop image_gallery constrains
alter table image_gallery
drop constraint FK_D23B2FE63DA5256D

alter table image_gallery
drop constraint FK_D23B2FE64E7AF8F

// alter table image_gallery

alter table image_gallery
add constraint FK_D23B2FE64E7AF8F
foreign key (gallery_id)
references gallery(id)
on delete cascade

alter table image_gallery
add constraint FK_D23B2FE63DA5256D
foreign key (image_id)
references image(id)
on delete cascade

// drop image constrain
alter table image
drop constraint FK_C53D045FA76ED395
//
alter table image
add constraint FK_C53D045FA76ED395
foreign key (user_id)
references user(id)
on delete cascade


alter table comment
drop constraint FK_9474526C3DA5256D

alter table comment
add constraint FK_9474526C3DA5256D
foreign key (image_id)
references image(id)
on delete cascade


alter table comment
drop constraint FK_9474526C4E7AF8F

alter table comment
add constraint FK_9474526C4E7AF8F
foreign key (gallery_id)
references gallery(id)
on delete cascade
